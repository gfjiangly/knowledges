![img](assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80/20180919193810175.png)

从图上可以看出，两个线程之间的栈是独立的，其他是共享的，所以，在操作共享区域的时候才有可能出现同步需要，操作栈不需要同步。pthread也提供了私有堆机制。

`ulimit -s`通过这个命令可以查看系统默认的栈大小以及修改应用运行时的栈大小，默认的8192KB。Linux系统中使用clone机制来实现线程，实际上线程就是一个轻量的进程，因此其栈大小依然是遵循系统的ulimit设置来配置的。

```bash
ulimit -s 512  # 修改栈容量为512KB
```

代码修改使用`pthread_attr_setstacksize`函数

区分与进程的内存布局：

1. 由一个栈切分出多个栈分配给不同的线程
2. 共用一份代码，但是各个线程的pc（指令寄存器）指向的代码不同